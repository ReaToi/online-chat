# Chat Frontend Application

Клиентская часть веб-приложения для обмена сообщениями между пользователями в личных и групповых чатах с поддержкой реального времени через WebSocket.

## Технологический стек

- **Frontend**: React 18
- **Язык**: JavaScript (ES6+)
- **Архитектура**: Feature-Sliced Design (FSD)
- **Сетевое взаимодействие**: HTTP (REST API), WebSocket
- **Хранение токена**: Cookies
- **Сборщик**: Vite

## Структура проекта (FSD)

```
src/
├── app/              # Инициализация приложения, роутинг, провайдеры
│   ├── providers/    # Провайдеры (роутер, защищенные роуты)
│   └── styles/       # Глобальные стили
├── pages/            # Страницы приложения
│   ├── login/        # Страница авторизации
│   ├── register/     # Страница регистрации
│   ├── chats/        # Страница списка чатов
│   └── chat/         # Страница чата
├── widgets/          # Крупные самостоятельные блоки (не используется в текущей реализации)
├── features/         # Бизнес-сущности (авторизация, создание чата)
│   ├── auth/         # Авторизация (login, register)
│   └── chat/         # Функционал чатов (create-chat)
├── entities/         # Бизнес-сущности (User, Conversation, Message)
│   ├── user/         # API для работы с пользователями
│   ├── conversation/ # API для работы с чатами
│   └── message/      # API для работы с сообщениями
└── shared/           # Переиспользуемые модули
    ├── ui/           # UI компоненты (Button, Input, Loader)
    └── lib/          # Утилиты (API клиент, WebSocket, cookies)
```

## Установка и запуск

### Предварительные требования

- Node.js 18+ 
- npm или yarn

### Установка зависимостей

```bash
npm install
```

### Настройка окружения

Создайте файл `.env` в корне проекта:

```env
VITE_API_URL=http://0.0.0.0:8000
```

**Примечание**: Vite использует префикс `VITE_` для переменных окружения, которые доступны в клиентском коде.

### Запуск в режиме разработки

```bash
npm run dev
```

Приложение будет доступно по адресу `http://localhost:3000`

### Сборка для продакшена

```bash
npm run build
```

Собранные файлы будут в директории `dist/`

### Предпросмотр продакшен сборки

```bash
npm run preview
```

## API Endpoints

### Авторизация и регистрация

- `POST /api/chat/users/register/` - Регистрация пользователя
- `POST /api/chat/users/login/` - Авторизация (токен сохраняется в cookies)
- `GET /api/chat/users/me/` - Получение текущего пользователя
- `GET /api/chat/users/?username=string` - Поиск пользователей

### Чаты

- `GET /api/chat/conversations/` - Список чатов
- `POST /api/chat/conversations/` - Создание чата
- `GET /api/chat/conversations/{id}/participants` - Участники чата
- `POST /api/chat/conversations/{id}/participants` - Добавление участника

### Сообщения

- `GET /api/chat/messages/{conversation_id}?limit=50&offset=0` - Получение сообщений (пагинация)

### WebSocket

- `ws://{API_HOST}/api/chat/ws/conversations/{conversation_id}/?Authorization={token}` - WebSocket подключение для чата

## Основной функционал

### Авторизация и регистрация

- Страница авторизации (`/login`)
  - Вход по username или email
  - Валидация полей
  - Обработка ошибок
  - Автоматический редирект на `/chats` при успехе

- Страница регистрации (`/register`)
  - Регистрация с полями: username, email, password
  - Валидация email и пароля
  - Автоматический редирект на `/login` после успешной регистрации

### Список чатов (`/chats`)

- Отображение всех чатов пользователя
- Показ названия, типа (private/group) и последнего сообщения
- Создание нового чата (модальное окно)
- Поиск пользователей для добавления в чат
- Выбор типа чата (личный/групповой)

### Чат (`/chats/:id`)

- Отображение сообщений в реальном времени
- Пагинация сообщений при скролле вверх
- Отправка сообщений через WebSocket
- Автоматическое переподключение при разрыве соединения
- Индикация собственных сообщений

## Особенности реализации

### Обработка ошибок

- Автоматический редирект на `/login` при 401 ошибке
- Отображение ошибок валидации на формах
- Обработка ошибок сети и сервера

### Оптимизация

- Использование `useCallback` для оптимизации ререндеров
- Пагинация сообщений для уменьшения нагрузки
- Ленивая загрузка данных

### Безопасность

- Токен хранится в cookies с httpOnly (настраивается на бэкенде)
- Защищенные маршруты с проверкой токена
- Автоматическая очистка токена при выходе

## Развертывание

Приложение готово для развертывания через Docker (см. `Dockerfile`):

```bash
docker build -t chat-frontend .
docker run -p 80:80 chat-frontend
```

Для продакшена убедитесь, что переменная окружения `VITE_API_URL` установлена в правильное значение при сборке.

## Дополнительная информация

- Все API запросы используют interceptors для автоматической добавки токена
- WebSocket автоматически переподключается при разрыве соединения
- Сообщения сортируются по времени (от старых к новым)
- При скролле вверх автоматически подгружаются более старые сообщения

